# ìž…ì‹¤ ì²´í¬ í•´ì£¼ì„¸ìš” !! ðŸŽˆ

## CROSS JOIN
- ì˜ˆì œ ë¬¸ì œ : usersì™€ ordersì˜ _ëª¨ë“  ê°€ëŠ¥í•œ í–‰ ì¡°í•©_ ì„ ë§Œë“¤ì–´ë‚´ëŠ” ì¿¼ë¦¬ë¥¼ ìž‘ì„±í•˜ì‹œì˜¤.

```sql
SELECT * FROM users u CROSS JOIN orders o;
```
- CROSS JOINì€ ë‘ ì§‘í•©ì„ ì¡°í•©í•´ ë§Œë“¤ ìˆ˜ ìžˆëŠ” ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ë¥¼ ìƒì„±í•˜ëŠ” `ì¹´í…Œì‹œì•ˆ ê³±(cartesian product)`ì„ ì¶œë ¥í•œë‹¤. u.idì™€ o.user_idë¥¼ ì—°ê²°í•˜ëŠ” ë“±ì˜ ì¡°ê±´ì´ ì—†ì´ ë‘ í…Œì´ë¸”ì˜ ëª¨ë“  í–‰ì„ í•©ì³ì„œ ë§Œë“¤ ìˆ˜ ìžˆëŠ” ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ë¥¼ ë§Œë“œëŠ” ê²ƒì— í•´ë‹¹í•¨.
- ì˜ˆë¥¼ ë“¤ì–´ 10í–‰ì¸ í…Œì´ë¸”ê³¼ 20í–‰ì¸ í…Œì´ë¸”ì„ CROSS JOINí•˜ë©´ ê²°ê³¼ í…Œì´ë¸”ì€ 10*20ì¸ 200í–‰ì´ ë©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ì™¸ì˜ ê²½ìš°ì˜ ìˆ˜ëŠ” ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ë¥¼ ë§Œë“¤ì–´ë‚´ê¸° ë•Œë¬¸ì— ON ì¡°ê±´ì„ ì„¤ì •í•  í•„ìš”ê°€ ì—†ìŒ.

## JOINì— ëŒ€í•œ ì „ë°˜ì ì¸ ì •ë¦¬
- ë‘ í…Œì´ë¸”ì˜ í–‰ì„ ì„œë¡œ ì¡°í•©í•˜ëŠ” ê³¼ì •ì¸ë°, ì—¬ëŸ¬ ê°€ì§€(LEFT, RIGHT, INNER, CROSS, FULL OUTER)ê°€ ì¡´ìž¬í•˜ë©´ì„œ, ON ì¡°ê±´ì„ í™œìš©í•˜ì—¬ ì „ì²´ ê²½ìš°ì˜ ìˆ˜ì—ì„œ ì–´ë–¤ í–‰ë§Œ ê°€ì ¸ì˜¬ ìˆ˜ ìžˆì„ì§€ë¥¼ ì •í•  ìˆ˜ ìžˆë‹¤.
- FULL OUTER JOINì˜ ê²½ìš° CROSS JOINê³¼ ì°¨ì´ê°€ ì¡´ìž¬í•˜ëŠ”ë°, LEFT JOINì˜ ê²°ê³¼ê°’ê³¼ RIGHT JOINì˜ ê²°ê³¼ê°’ì„ _ì¤‘ë³µ ì—†ì´_ ê²°í•©í•˜ëŠ” ê°œë…ìœ¼ë¡œ, í•©ì§‘í•©ì— í•´ë‹¹í•¨. ì „ì²´ë¥¼ êµ¬í•˜ëŠ” ì»¨ì…‰ì„ ìœ ì‚¬í•˜ë‚˜ í•©ì§‘í•©ì´ ì „ì²´ ê²½ìš°ì˜ ìˆ˜ë¥¼ ì˜ë¯¸í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— êµ¬ë¶„í•´ì„œ ì‚¬ìš©í•  í•„ìš”ê°€ ìžˆìŠµë‹ˆë‹¤. CROSS JOINê³¼ ë‹¬ë¦¬ ON ì¡°ê±´ì„ ìš”êµ¬í•©ë‹ˆë‹¤.

- ìš´ì˜ í™˜ê²½ì—ì„œëŠ” CROSS JOINì„ ì œí•œí•˜ëŠ” íŽ¸ìž…ë‹ˆë‹¤. ì „ì²´ ê²½ìš°ì˜ ìˆ˜ë¥¼ êµ¬í•˜ëŠ”ë° ì‹¤ì œë¡œ í•„ìš”í•œ ê²½ìš°ëŠ” ê±°ì˜ ì—†ê¸° ë•Œë¬¸ìž…ë‹ˆë‹¤.

- FULL OUTER JOINì˜ ê²½ìš° DBì— ë”°ë¼ ì•„ì˜ˆ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš°ë„ ìžˆìŒ.

### ì—°ìŠµë¬¸ì œ
1. usersì™€ staffë¥¼ ì°¸ê³ í•˜ì—¬ íšŒì› ì¤‘ ì§ì›ì¸ ì‚¬ëžŒì˜ íšŒì› id, ì´ë©”ì¼, ê±°ì£¼ë„ì‹œ, ê±°ì£¼êµ­ê°€, ì„±, ì´ë¦„ì„ ì¶œë ¥í•˜ì‹œì˜¤.
![alt text](image-28.png)
![alt text](image-32.png)
2. staffì™€ ordersë¥¼ ì°¸ê³ í•˜ì—¬ ì§ì› ì•„ì´ë””ê°€ 3ë²ˆ, 5ë²ˆì¸ ì§ì›ì˜ ë‹´ë‹¹ ì£¼ë¬¸ì„ ì¶œë ¥í•˜ì‹œì˜¤. ë‹¨ ì§ì›id, ì§ì› ì„±, ì£¼ë¬¸ ì•„ì´ë””, ì£¼ë¬¸ì¼ìžë§Œ ì¶œë ¥í•˜ì‹œì˜¤.
![alt text](image-29.png)

3. usersì™€ ordersë¥¼ ì°¸ê³ í•˜ì—¬ íšŒì› êµ­ê°€ ë³„ ì£¼ë¬¸ ê±´ìˆ˜ë¥¼ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì¶œë ¥í•˜ì‹œì˜¤.
![alt text](image-30.png)

4. ordersì™€ orderdetails, productsë¥¼ ì°¸ê³ í•˜ì—¬ íšŒì› ì•„ì´ë”” ë³„ ì£¼ë¬¸ ê¸ˆì•¡ì˜ ì´í•©ì„ ì •ìƒ ê°€ê²©ê³¼ í• ì¸ ê°€ê²© ê¸°ì¤€ìœ¼ë¡œ ê°ê° êµ¬í•˜ì‹œì˜¤. ë‹¨, ì •ìƒ ê°€ê²© ì£¼ë¬¸ ê¸ˆì•¡ì˜ ì´í•© ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬í•  ê²ƒ.
![alt text](image-31.png)
5. ì´í•˜ì˜ ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” í…Œì´ë¸”ì´ ìžˆë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ ì§ˆë¬¸ì— ë‹µí•˜ì‹œì˜¤.
    - ì™¼ìª½ í…Œì´ë¸” A : ì»¬ëŸ¼ ê°œìˆ˜ 5 ê°œ / 150 í–‰
    - ì˜¤ë¥¸ìª½ í…Œì´ë¸” B : ì»¬ëŸ¼ ê°œìˆ˜ 7ê°œ / 100 í–‰
    - ë‘ í…Œì´ë¸”ì€ ê³µí†µ í‚¤ ê°’ ì»¬ëŸ¼ì„ 1 ê°œ ë³´ìœ 
  ìœ„ ì¡°ê±´ì˜ ë‘ í…Œì´ë¸”ì„ CROSS/LEFT/RIGHT/INNER JOINìœ¼ë¡œ ê²°í•©í–ˆì„ ë•Œ ê²°ê³¼ í…Œì´ë¸”ì˜ í–‰ê³¼ ì—´ ê°œìˆ˜ë¥¼ ê³„ì‚°í•˜ì‹œì˜¤(SELECT * ê¸°ì¤€) 

- CROSS JOIN
  - rows : 15000í–‰(150*100)
  - columns : 12ê°œ

- LEFT JOIN
  - rows : ìµœì†Œ 150, ìµœëŒ€ 15000í–‰
  - columns : 12ê°œ

- RIGHT JOIN
  - rows : ìµœì†Œ 100, ìµœëŒ€ 15000í–‰
  - columns : 12ê°œ

- INNER JOIN
  - rows : ìµœì†Œ 0í–‰, ìµœëŒ€ 15000í–‰
  - columns : 12ê°œ

- ì´ìƒì˜ ë‹µì•ˆì€ SQLD ì¤‘ì‹¬ì´ë¼ê¸° ë³´ë‹¤ ì‹¤ë¬´ì—ì„œ ì¼ì–´ë‚  ìˆ˜ ìžˆëŠ” ìˆ˜ì¤€ì´ê³  ì‹¤ì œ ì‹œí—˜ ìƒí™©ì—ì„œëŠ” êµ¬êµ¬ë‹¨ ìˆ˜ì¤€+@ë¡œ ë‚˜ì˜¬ê±°ê¸° ë•Œë¬¸ì— ì‹¤ì œ rows ê³„ì‚° ì •ë„ëŠ” í•˜ê²Œ ë  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

```sql
SELECT 
  u.id, 
  u.username, 
  u.country, 
  s.last_name, 
  s.first_name 
  FROM users u inner JOIN staff s 
  ON u.id = s.user_id;

SELECT s.id, s.last_name, o.id, o.order_date 
  FROM staff s LEFT JOIN orders o ON s.id = o.staff_id 
  WHERE s.id IN (3, 5);

SELECT u.country, COUNT(DISTINCT o.id) AS ë‹´ë‹¹ì£¼ë¬¸ 
  FROM users u LEFT JOIN orders o ON u.id = o.user_id 
  GROUP BY u.country 
  ORDER BY ë‹´ë‹¹ì£¼ë¬¸ DESC;

SELECT 
  o.user_id, 
  round(SUM(price * quantity), 2) AS ì •ìƒí•©,
  round(SUM(discount_price * quantity), 2) AS í• ì¸í•© 
  FROM orders o LEFT JOIN orderdetails od ON o.id = od.order_id 
  INNER JOIN products p ON od.product_id = p.id 
  GROUP BY o.user_id 
  ORDER BY ì •ìƒí•© DESC;
```

## UNION
- ì»¬ëŸ¼ ëª©ë¡ì´ ê°™ì€ ë°ì´í„°ë¥¼ ìœ„ì•„ëž˜ ê²°í•©
- ì»¬ëŸ¼ì˜ í˜•ì‹ê³¼ ê°œìˆ˜ê°€ ê°™ì€ ë‘ ë°ì´í„° ê²°ê³¼ ì§‘í•©ì„ í•˜ë‚˜ë¡œ ê²°í•©í•˜ëŠ” ê¸°ëŠ¥.
- JOINì€ ONì´ ìš”êµ¬ëœë‹¤ëŠ” ì ì´ ìžˆì§€ë§Œ ì• ì´ˆì— ì œì•½ ì¡°ê±´ì´ ìžˆëŠ” UNIONì˜ ê²½ìš°ëŠ” ì œì•½ ì¡°ê±´ì„ ì¼ì¹˜ì‹œí‚¨ë‹¤ë©´ ê²°í•© ìžì²´ëŠ” ê°€ëŠ¥í•¨.

- ì˜ˆì œ ë¬¸ì œ : usersë¥¼ full scaní•œ ê²°ê³¼ ì§‘í•©ì—ì„œ ê° í–‰ì„ 2 ë²ˆì”© ì¶œë ¥í•˜ê¸°
```sql
(SELECT * FROM users) UNION (SELECT * FROM users);
```
ì´ìƒì˜ ì¿¼ë¦¬ë¥¼ ìƒê°í–ˆì„ ë•Œ ì•žì—ì„œ ë°°ìš´ ì´ë¡ ì ì¸ ë¶€ë¶„ê³¼ í•©ì³¤ì„ ë•Œ 77 * 2 ì˜ ê²°ê³¼ê°’ì´ ë‚˜ì™€ì•¼ í•  ê²ƒìœ¼ë¡œ ë³´ìž…ë‹ˆë‹¤. í•˜ì§€ë§Œ
![ìœ ë‹ˆì˜¨](image-33.png)

ì¢Œì¸¡ ìƒë‹¨ì„ í™•ì¸í–ˆì„ ë•Œ `ê²°ê³¼`ë¡œ í‘œì‹œë˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì•„ usersë¥¼ ê·¸ëŒ€ë¡œ ê°€ì§€ê³  ì˜¨ ê²ƒì´ ì•„ë‹ˆë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ì´ëŠ” ì¤‘ë³µì œê±°ê°€ ì ìš©ëœ ê²°ê³¼ê°’ì— í•´ë‹¹í•©ë‹ˆë‹¤.

- ì¤‘ë³µ ì œê±°ë¥¼ í•˜ì§€ ì•ŠëŠ” ë°©ì‹ìœ¼ë¡œ ì ìš©í•˜ëŠ” ë°©ë²• : `UNION ALL`
```sql
(
	SELECT * 
		FROM users
) 
UNION ALL
(
	SELECT * 
		FROM users
)
ORDER BY id;
```
- UNION ë° ALLì„ ì ìš©í–ˆì„ ë•Œ SELECTë¬¸ì„ ì“¸ ë•Œ full scaní•œë‹¤ë©´ ìƒê´€ì—†ì§€ë§Œ íŠ¹ì • ì»¬ëŸ¼ë§Œ ë³´ì—¬ì£¼ê² ë‹¤ê³  í•œë‹¤ë©´ ì²« ë²ˆì§¸ í…Œì´ë¸”ì—ì„œ ì»¬ëŸ¼ì„ íŽ¸ì§‘í•œ ê²ƒê³¼ ë™ì¼í•˜ê²Œ ë‘ ë²ˆ ì§¸ í…Œì´ë¸”ë„ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.

```sql
(SELECT id, phone, country, city FROM users)
UNION ALL
(SELECT id, phone, country, city FROM users)
ORDER BY id;
```

ê·¸ëž˜ì„œ ì§€ì‚¬ì—ì„œ ì˜¬ë¼ì˜¨ ê° í…Œì´ë¸”ì˜ rowë“¤ì„ í†µí•©í•  ë•Œ ë³¸ì‚¬ì—ì„œ UNIONì„ ì“¸ ìˆ˜ëŠ” ìžˆê² ë„¤ìš”.
ì‹¤ë¬´ì ìœ¼ë¡œ UNIONë³´ë‹¤ëŠ” UNION ALLì„ ë” ê¶Œìž¥í•©ë‹ˆë‹¤. ëŒ€ëŸ‰ì˜ ë°ì´í„°ì—ì„œ ì¤‘ë³µ í•­ëª©ì„ ì œê±°í•  ë•Œ ë¶€í•˜ê°€ ì¼ì–´ë‚  ìˆ˜ ìžˆê¸° ë•Œë¬¸ì— ì¼ë‹¨ ì¤‘ë³µë˜ë”ë¼ë„ ë³´ì—¬ì£¼ëŠ” ê²ƒì„ ì¢€ ë” ì„ í˜¸í•˜ê³ , ê·¸ í›„ì— ì¡°ê±´ì ˆ ë“±ì„ í†µí•´ ë¶„ë¥˜í•©ë‹ˆë‹¤.

- ë¬¸ì œ : usersì—ì„œ ê±°ì£¼ êµ­ê°€ê°€ Koreaì¸ íšŒì› ì •ë³´ë§Œ ì¶”ì¶œí•˜ê³ , Mexicoì¸ íšŒì› ì •ë³´ë§Œ ì¶”ì¶œí•˜ì—¬ _ê²°í•© í•˜ì‹œì˜¤._ ë‹¨, íšŒì›ì•„ì´ë””, ì—°ë½ì²˜, ê±°ì£¼ë„ì‹œ, ê±°ì£¼êµ­ê°€ë§Œ ì¶œë ¥í•˜ê³ , ê±°ì£¼êµ­ê°€ ê¸°ì¤€ ì•ŒíŒŒë²³ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ìž‘ì„±í•˜ì‹œì˜¤.

```sql
SELECT id, phone, city, country FROM users WHERE country = 'Korea' UNION ALL SELECT id, phone, city, country FROM users WHERE country = 'Mexico' ORDER BY country;
```

### ì—°ìŠµë¬¸ì œ
1. ordersì—ì„œ ì£¼ë¬¸ì¼ìžê°€ 2015ë…„ 10ì›”ì¸ ê±´ê³¼ 2015ë…„ 12ì›”ì¸ ê±´ì„ SELECTë¡œ ê°ê° ì¶”ì¶œí•˜ê³  UNION ALLì„ ì‚¬ìš©í•´ í•˜ë‚˜ë¡œ ê²°í•©í•˜ì‹œì˜¤. ë‹¨, ìµœì¢… ê²°ê³¼ëŠ” ìµœì‹  ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì‹œì˜¤.
![alt text](image-34.png)
2. usersì—ì„œ ë¯¸êµ­ì— ê±°ì£¼ ì¤‘ì´ë©´ì„œ ë§ˆì¼€íŒ… ìˆ˜ì‹ ì— ë™ì˜í•œ íšŒì› ì •ë³´ì™€ í”„ëž‘ìŠ¤ì— ê±°ì£¼ ì¤‘ì´ë©´ì„œ ë§ˆì¼€íŒ… ìˆ˜ì‹  ë™ì˜ í•˜ì§€ ì•Šì€ íšŒì› ì •ë³´ë¥¼ SELECTë¡œ ê°ê° ì¶”ì¶œí•˜ê³ , ë‘ ê²°ê³¼ ì§‘í•©ì„ UNION ALLì„ ì‚¬ìš©í•´ í•˜ë‚˜ë¡œ ê²°í•©í•˜ì‹œì˜¤. ë‹¨ ìµœì¢… ê²°ê³¼ëŠ” id, ì—°ë½ì²˜, ê±°ì£¼ êµ­ê°€, ê±°ì£¼ ë„ì‹œ, ë§ˆì¼€íŒ… ìˆ˜ì‹  ë™ì˜ ì—¬ë¶€ ì»¬ëŸ¼ë§Œ ì¶”ì¶œí•˜ê³ , ê±°ì£¼ êµ­ê°€ ê¸°ì¤€ ì•ŒíŒŒë²³ ìˆœ ì •ë ¬í•˜ì‹œì˜¤. ì»¬ëŸ¼ëª… í•œêµ­ì–´ë¡œ ë‹¤ ë°”ê¾¸ì‹œì˜¤.
![alt text](image-35.png)
3. UNIONì„ í™œìš©í•˜ì—¬ ì£¼ë¬¸ ìƒì„¸ ì •ë³´ í…Œì´ë¸” orderdetailsì™€ ì œí’ˆ ì •ë³´ í…Œì´ë¸” productsë¥¼ FULL OUTER JOIN ì¡°ê±´ìœ¼ë¡œ ê²°í•©í•˜ì—¬ ì¶œë ¥í•˜ì‹œì˜¤.
![alt text](image-36.png)
```sql
SELECT * 
  FROM orders 
  WHERE order_date >='2015-10-01' AND order_date < '2015-11-01' 
  UNION ALL 
  SELECT * FROM orders 
  WHERE order_date >= '2015-12-01' AND order_date < '2016-01-01' 
  ORDER BY order_date DESC;

SELECT 
  id AS íšŒì›ì•„ì´ë””, 
  phone AS ì—°ë½ì²˜, 
  country AS ê±°ì£¼êµ­ê°€, 
  city AS ê±°ì£¼ë„ì‹œ, 
  is_marketing_agree AS ë§ˆì¼€íŒ…ìˆ˜ì‹ ë™ì˜ 
  FROM users 
  WHERE country = 'USA' AND is_marketing_agree = 1 
  UNION ALL 
  SELECT id AS íšŒì›ì•„ì´ë””, 
  phone AS ì—°ë½ì²˜, 
  country AS ê±°ì£¼êµ­ê°€, 
  city AS ê±°ì£¼ë„ì‹œ, 
  is_marketing_agree AS ë§ˆì¼€íŒ…ìˆ˜ì‹ ë™ì˜ 
  FROM users 
  WHERE country = 'France' AND is_marketing_agree = 0 
  ORDER BY ê±°ì£¼êµ­ê°€;

SELECT * 
  FROM orderdetails o LEFT JOIN products p 
  ON o.product_id = p.id 
UNION 
SELECT * 
  FROM orderdetails o RIGHT JOIN products p ON o.product_id = p.id;
```